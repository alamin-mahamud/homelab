# Kubernetes Deployment Ansible

Ansible playbooks for deploying and managing Kubernetes cluster on the provisioned infrastructure.

## Prerequisites
- Infrastructure provisioned via Terraform
- Generated `inventory.ini` from Terraform output
- SSH access to all nodes

## Structure
```
ansible/
├── inventory.ini           # Generated by Terraform
├── playbooks/             # Ansible playbooks
│   ├── k8s-cluster.yml    # Main cluster deployment
│   ├── etcd-cluster.yml   # Dedicated etcd setup
│   └── post-install.yml   # Post-installation tasks
├── roles/                 # Ansible roles
└── group_vars/           # Group variables
```

## Deployment Steps

### 1. Verify Inventory
```bash
# Check generated inventory
cat inventory.ini

# Test connectivity
ansible all -i inventory.ini -m ping
```

### 2. Deploy Kubernetes
```bash
# Deploy complete cluster
ansible-playbook -i inventory.ini playbooks/k8s-cluster.yml

# Or step by step:
ansible-playbook -i inventory.ini playbooks/etcd-cluster.yml
ansible-playbook -i inventory.ini playbooks/k8s-masters.yml  
ansible-playbook -i inventory.ini playbooks/k8s-workers.yml
```

### 3. Post-Installation
```bash
# Configure cluster
ansible-playbook -i inventory.ini playbooks/post-install.yml

# Verify deployment
kubectl get nodes
```

## Cluster Architecture
- **etcd**: Dedicated 3-node cluster (external to K8s masters)
- **Masters**: 3-node HA control plane (without etcd)
- **Workers**: 10 nodes for workload execution
- **CNI**: Flannel networking
- **Load Balancer**: HAProxy for API server

## Management
```bash
# Scale workers (update terraform.tfvars first)
terraform apply
terraform output -raw ansible_inventory > inventory.ini
ansible-playbook -i inventory.ini playbooks/add-workers.yml

# Update cluster
ansible-playbook -i inventory.ini playbooks/update-cluster.yml

# Backup etcd
ansible-playbook -i inventory.ini playbooks/backup-etcd.yml
```

## Future Features
- [ ] Automated certificate rotation
- [ ] Cluster monitoring setup
- [ ] Application deployment playbooks
- [ ] Backup and restore procedures